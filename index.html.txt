<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Simulador Imobiliário Herbert Faber</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1e40af">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>

<body class="bg-gray-100">

<!-- TOPO -->
<header class="flex items-center px-6 py-4 bg-white border-b">
  <img src="img/logo-herbert-faber.png" class="h-12">
</header>

<!-- CONTEÚDO -->
<div class="p-6 max-w-5xl mx-auto">

  <!-- CONFIGURAÇÃO -->
  <input id="valorUnidade" type="number" placeholder="Valor do imóvel"
   class="w-full p-2 border rounded mb-3" oninput="atualizar()">

  <input id="ato" type="number" placeholder="Ato"
   class="w-full p-2 border rounded mb-3" oninput="atualizar()">

  <div class="grid grid-cols-2 gap-2 mb-3">
    <input id="mensalQtd" type="number" placeholder="Qtd Meses" oninput="atualizar()" class="p-2 border rounded">
    <input id="mensalValor" type="number" placeholder="Valor Mensal" oninput="atualizar()" class="p-2 border rounded">
  </div>

  <div class="grid grid-cols-2 gap-2 mb-3">
    <input id="anualQtd" type="number" placeholder="Qtd Anuais" oninput="atualizar()" class="p-2 border rounded">
    <input id="anualValor" type="number" placeholder="Valor Anual" oninput="atualizar()" class="p-2 border rounded">
  </div>

  <input id="unica" type="number" placeholder="Parcela Única"
   class="w-full p-2 border rounded mb-4" oninput="atualizar()">

  <!-- RESULTADO -->
  <div class="bg-white p-6 rounded shadow">
    <p>Saldo Financiamento:</p>
    <h2 id="view-saldo" class="text-2xl font-bold text-green-600">R$ 0,00</h2>
    <p class="text-sm mt-2">Proposta válida até: <b id="validade"></b></p>
  </div>

</div>

<script>
const moeda = v => v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});

function atualizar(){
  const valor = Number(valorUnidade.value||0);
  const total = Number(ato.value||0) +
    (mensalQtd.value||0)*(mensalValor.value||0) +
    (anualQtd.value||0)*(anualValor.value||0) +
    Number(unica.value||0);

  view-saldo.innerText = moeda(valor-total);

  const d = new Date();
  d.setDate(d.getDate()+7);
  validade.innerText = d.toLocaleDateString("pt-BR");

  localStorage.setItem("simulacao", JSON.stringify({
    valor, ato:ato.value, mensalQtd:mensalQtd.value,
    mensalValor:mensalValor.value, anualQtd:anualQtd.value,
    anualValor:anualValor.value, unica:unica.value
  }));
}

if("serviceWorker" in navigator){
  navigator.serviceWorker.register("service-worker.js");
}

window.onload=()=>{
  const d=JSON.parse(localStorage.getItem("simulacao"));
  if(!d)return;
  Object.keys(d).forEach(k=>window[k]&&(window[k].value=d[k]));
  atualizar();
}
</script>

</body>
</html>